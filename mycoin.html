<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ERC-20 Token DApp</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
        }
        .section {
            background-color: white;
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 24px;
        }
        .btn {
            @apply px-6 py-3 font-medium text-white transition-colors duration-200 rounded-md shadow-md focus:outline-none focus:ring-2 focus:ring-offset-2;
        }
        .btn-primary {
            @apply bg-blue-600 hover:bg-blue-700 focus:ring-blue-500;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">

    <div class="container bg-white p-8 rounded-xl shadow-lg">
        <h1 class="text-3xl font-bold text-center mb-6 text-gray-800">My ERC-20 Token DApp</h1>
        <p class="text-center text-gray-600 mb-8">Connect your wallet to view your token balance and send tokens.</p>

        <!-- Wallet Connection Section -->
        <div class="section">
            <h2 class="text-xl font-semibold mb-4 text-gray-700">Wallet Status</h2>
            <div id="walletStatus" class="flex flex-col items-center justify-center space-y-4">
                <button id="connectBtn" class="btn btn-primary">Connect Wallet</button>
                <p id="addressDisplay" class="text-sm font-mono bg-gray-200 p-2 rounded-md hidden"></p>
                <div id="balanceInfo" class="text-center hidden">
                    <p class="text-gray-700">Token Balance: <span id="tokenBalance" class="font-bold">0</span></p>
                </div>
            </div>
        </div>

        <!-- Transfer Section -->
        <div id="transferSection" class="section hidden">
            <h2 class="text-xl font-semibold mb-4 text-gray-700">Transfer Tokens</h2>
            <div class="space-y-4">
                <div>
                    <label for="toAddress" class="block text-sm font-medium text-gray-700 mb-1">Recipient Address</label>
                    <input type="text" id="toAddress" class="w-full border border-gray-300 rounded-md p-2" placeholder="e.g., 0x..." />
                </div>
                <div>
                    <label for="amount" class="block text-sm font-medium text-gray-700 mb-1">Amount</label>
                    <input type="number" id="amount" class="w-full border border-gray-300 rounded-md p-2" placeholder="e.g., 10" />
                </div>
                <button id="transferBtn" class="btn btn-primary w-full">Transfer Tokens</button>
            </div>
        </div>
        
        <!-- Messages -->
        <div id="messageBox" class="bg-blue-100 text-blue-800 p-3 rounded-md hidden mt-4"></div>

    </div>

    <script type="module">
        import { ethers } from "https://cdn.jsdelivr.net/npm/ethers@6.10.0/dist/ethers.min.js";

  
        const tokenAddress = "0x8979E3316E25e36A7b119aE1A9D571a069153579";
        const tokenABI = [
            "function name() view returns (string)",
            "function symbol() view returns (string)",
            "function totalSupply() view returns (uint256)",
            "function balanceOf(address owner) view returns (uint256)",
            "function transfer(address to, uint amount) returns (bool)",
            "event Transfer(address indexed from, address indexed to, uint amount)"
        ];

        // UI elements
        const connectBtn = document.getElementById('connectBtn');
        const addressDisplay = document.getElementById('addressDisplay');
        const balanceInfo = document.getElementById('balanceInfo');
        const tokenBalanceSpan = document.getElementById('tokenBalance');
        const transferSection = document.getElementById('transferSection');
        const toAddressInput = document.getElementById('toAddress');
        const amountInput = document.getElementById('amount');
        const transferBtn = document.getElementById('transferBtn');
        const messageBox = document.getElementById('messageBox');

        let provider, signer, contract;

        // Display a message in the message box
        function displayMessage(message, type = 'info') {
            messageBox.textContent = message;
            messageBox.className = `p-3 rounded-md mt-4 hidden`; // Reset classes
            if (type === 'info') {
                messageBox.classList.add('bg-blue-100', 'text-blue-800');
            } else if (type === 'success') {
                messageBox.classList.add('bg-green-100', 'text-green-800');
            } else if (type === 'error') {
                messageBox.classList.add('bg-red-100', 'text-red-800');
            }
            messageBox.classList.remove('hidden');
        }

        // Hide the message box
        function hideMessage() {
            messageBox.classList.add('hidden');
        }

        // Connect wallet and get address
        async function connectWallet() {
            if (typeof window.ethereum !== 'undefined') {
                try {
                    await window.ethereum.request({ method: 'eth_requestAccounts' });
                    provider = new ethers.BrowserProvider(window.ethereum);
                    signer = await provider.getSigner();
                    const address = await signer.getAddress();
                    
                    // Display connected wallet info
                    addressDisplay.textContent = `Address: ${address.substring(0, 6)}...${address.substring(38)}`;
                    addressDisplay.classList.remove('hidden');
                    connectBtn.classList.add('hidden');
                    transferSection.classList.remove('hidden');

                    // Initialize the contract instance
                    contract = new ethers.Contract(tokenAddress, tokenABI, signer);
                    
                    // Fetch and display balance
                    await fetchBalance();
                } catch (error) {
                    console.error("User denied account access or other error:", error);
                    displayMessage("Failed to connect wallet.", "error");
                }
            } else {
                displayMessage("MetaMask is not installed. Please install it to use this DApp.", "error");
                window.open("https://metamask.io/", "_blank");
            }
        }

        // Fetch and display the token balance
        async function fetchBalance() {
            if (!contract) return;
            try {
                const address = await signer.getAddress();
                const balance = await contract.balanceOf(address);
                tokenBalanceSpan.textContent = ethers.formatUnits(balance, 18);
                balanceInfo.classList.remove('hidden');
            } catch (error) {
                console.error("Error fetching balance:", error);
                displayMessage("Failed to fetch token balance.", "error");
            }
        }

        // Handle token transfer
        async function transferTokens() {
            hideMessage();
            const toAddress = toAddressInput.value;
            const amount = amountInput.value;
            
            if (!ethers.isAddress(toAddress)) {
                displayMessage("Please enter a valid recipient address.", "error");
                return;
            }
            if (isNaN(amount) || parseFloat(amount) <= 0) {
                displayMessage("Please enter a valid amount.", "error");
                return;
            }

            try {
                displayMessage("Waiting for transaction confirmation...", "info");
                const amountInWei = ethers.parseUnits(amount, 18);
                const tx = await contract.transfer(toAddress, amountInWei);
                await tx.wait(); // Wait for the transaction to be mined
                displayMessage("Transaction successful! Tokens transferred.", "success");
                await fetchBalance(); // Update balance
            } catch (error) {
                console.error("Transfer error:", error);
                displayMessage("Transfer failed. Check console for details.", "error");
            }
        }

        // Event listeners
        connectBtn.addEventListener('click', connectWallet);
        transferBtn.addEventListener('click', transferTokens);
    </script>
</body>
</html>
